<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–ª–æ—Ç v7.1 - –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#0a0a14;color:#fff;min-height:100vh;display:flex;flex-direction:column}

        .header{padding:20px;text-align:center;background:linear-gradient(180deg,#1a1a2e 0%,#0a0a14 100%);border-bottom:1px solid #333}
        .avatar{width:80px;height:80px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;font-size:40px;cursor:pointer;transition:all 0.3s}
        .avatar:hover{transform:scale(1.1)}
        .avatar.speaking{animation:speak 0.5s infinite}
        @keyframes speak{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        .status{color:#667eea;font-size:12px;margin-bottom:5px}
        h1{font-size:24px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}

        .chat{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:10px;max-height:50vh}
        .msg{max-width:85%;padding:12px 16px;border-radius:15px;font-size:15px;line-height:1.5}
        .msg.user{background:#2d2d44;align-self:flex-end}
        .msg.glott{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);align-self:flex-start}
        .msg.system{background:#f5576c20;border:1px solid #f5576c;align-self:center;font-size:13px}

        .controls{padding:15px;background:#1a1a2e;border-top:1px solid #333}
        .btn-row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;justify-content:center}
        button{padding:10px 15px;background:#2d2d44;border:1px solid #667eea;border-radius:20px;color:#fff;font-size:13px;cursor:pointer;transition:all 0.2s}
        button:hover{background:#667eea;transform:translateY(-2px)}
        button:active{transform:scale(0.95)}
        button.active{background:#667eea;box-shadow:0 0 10px rgba(102,126,234,0.5)}

        .voice-btn{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;font-size:30px;margin:10px auto;display:block;transition:all 0.3s}
        .voice-btn:hover{transform:scale(1.1);box-shadow:0 0 20px rgba(102,126,234,0.6)}
        .voice-btn.listening{background:#f5576c;animation:pulse 1.5s infinite}
        @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(245,87,108,0.7)}50%{box-shadow:0 0 0 20px rgba(245,87,108,0)}}

        .input-row{display:flex;gap:10px;margin-top:10px}
        input{flex:1;padding:12px;background:#2d2d44;border:1px solid #444;border-radius:10px;color:#fff;font-size:15px}
        input:focus{outline:none;border-color:#667eea}
        .send-btn{width:50px;height:50px;padding:0;border-radius:10px;background:#667eea;font-size:20px}

        .settings{position:fixed;top:0;right:-100%;width:80%;max-width:350px;height:100%;background:#1a1a2e;padding:20px;transition:right 0.3s;z-index:100;overflow-y:auto;border-left:1px solid #333}
        .settings.open{right:0}
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);opacity:0;pointer-events:none;transition:opacity 0.3s;z-index:99}
        .overlay.open{opacity:1;pointer-events:auto}
        .close-btn{position:absolute;top:10px;right:10px;width:40px;height:40px;background:#f5576c;border:none;border-radius:50%;font-size:20px}

        h3{color:#667eea;margin:20px 0 10px;font-size:16px}
        .preset-btn{display:block;width:100%;margin:5px 0;text-align:left;padding:12px}
        .preset-btn.active{background:#667eea}

        .hint{text-align:center;color:#888;font-size:13px;margin-top:10px}
        .debug{color:#666;font-size:11px;text-align:center;margin-top:5px;font-family:monospace}

        .game-box{background:#1e3a5f;padding:15px;border-radius:10px;margin:10px 0;display:none}
        .game-box.active{display:block}
    </style>
</head>
<body>
    <div class="header">
        <div class="avatar" id="avatar" onclick="app.testVoice()">üêô</div>
        <div class="status" id="status">–≥–æ—Ç–æ–≤</div>
        <h1>–ì–ª–æ—Ç v7.1</h1>
    </div>

    <div class="chat" id="chat"></div>

    <div class="game-box" id="gameBox">
        <h3>üéÆ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100</h3>
        <p>–í–∞—à–∏ –ø–æ–ø—ã—Ç–∫–∏: <span id="attempts">0</span></p>
        <input type="number" id="guessInput" placeholder="–í–∞—à–µ —á–∏—Å–ª–æ" min="1" max="100">
        <button onclick="game.checkGuess()" style="margin-top:10px;width:100%">–£–≥–∞–¥–∞—Ç—å</button>
        <p id="gameHint"></p>
    </div>

    <div class="controls">
        <div class="btn-row">
            <button onclick="app.setPersonality('friend')" id="btn-friend">üêô –î—Ä—É–≥</button>
            <button onclick="app.setPersonality('sarcastic')" id="btn-sarcastic">ü¶ë –°–∞—Ä–∫–∞—Å—Ç–∏–∫</button>
            <button onclick="app.setPersonality('wise')" id="btn-wise">üê¢ –ú—É–¥—Ä–µ—Ü</button>
            <button onclick="app.setPersonality('detective')" id="btn-detective">üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤</button>
        </div>

        <div class="btn-row">
            <button onclick="app.setVoice('intense')" id="btn-intense">‚ö° –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π</button>
            <button onclick="app.setVoice('calm')" id="btn-calm">üåä –°–ø–æ–∫–æ–π–Ω—ã–π</button>
            <button onclick="app.toggleTheme()">üåì –¢–µ–º–∞</button>
        </div>

        <button class="voice-btn" id="voiceBtn" onclick="voice.toggle()">üé§</button>

        <div class="input-row">
            <input type="text" id="textInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')app.sendText()">
            <button class="send-btn" onclick="app.sendText()">‚û§</button>
        </div>

        <div class="btn-row">
            <button onclick="app.startGame()">üéÆ –ò–≥—Ä–∞—Ç—å</button>
            <button onclick="app.showHelp()">‚ùì –ü–æ–º–æ—â—å</button>
            <button onclick="app.exportData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>

        <p class="hint" id="hint">–ù–∞–∂–º–∏—Ç–µ üé§ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ</p>
        <p class="debug" id="debug"></p>
    </div>

    <div class="overlay" id="overlay" onclick="app.closeSettings()"></div>

<script>
// –û—Ç–ª–∞–¥–∫–∞
function log(msg) {
    console.log('[–ì–ª–æ—Ç]', msg);
    document.getElementById('debug').textContent = msg;
}

// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
const app = {
    config: {
        personality: localStorage.getItem('glott_p') || 'friend',
        voice: localStorage.getItem('glott_v') || 'intense',
        theme: localStorage.getItem('glott_t') || 'dark'
    },

    personalities: {
        friend: {emoji: 'üêô', name: '–î—Ä—É–≥', greetings: ['–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ —Ç–µ–±—è —Å–ª—ã—à–∞—Ç—å!', '–û, —ç—Ç–æ —Ç—ã! –ö–∞–∫ –∂–∏–∑–Ω—å?']},
        sarcastic: {emoji: 'ü¶ë', name: '–°–∞—Ä–∫–∞—Å—Ç–∏–∫', greetings: ['–û, —Å–Ω–æ–≤–∞ —Ç—ã. –£—Ä–∞.', '–ü—Ä–∏–≤–µ—Ç. –ù–∞–¥–µ—é—Å—å, –ø–æ–≤–æ–¥ —Ö–æ—Ä–æ—à–∏–π.']},
        wise: {emoji: 'üê¢', name: '–ú—É–¥—Ä–µ—Ü', greetings: ['–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é. –ß—Ç–æ —Ç—Ä–µ–≤–æ–∂–∏—Ç —Ç–≤–æ–π —Ä–∞–∑—É–º?', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–∏–∞–ª–æ–≥.']},
        detective: {emoji: 'üïµÔ∏è', name: '–î–µ—Ç–µ–∫—Ç–∏–≤', greetings: ['–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–ª—É—á–∞–π...', '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∏—à–∏–Ω–∞.']}
    },

    voices: {
        intense: {rate: 1.1, pitch: 1.0, desc: '–ú–æ—â–Ω—ã–π'},
        calm: {rate: 0.9, pitch: 0.9, desc: '–°–ø–æ–∫–æ–π–Ω—ã–π'},
        deep: {rate: 0.8, pitch: 0.7, desc: '–ì–ª—É–±–æ–∫–∏–π'},
        friendly: {rate: 1.0, pitch: 1.1, desc: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π'}
    },

    init: function() {
        log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
        if (this.config.theme === 'light') {
            document.body.style.background = '#f5f5f5';
            document.body.style.color = '#333';
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
        this.updateButtons();

        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        setTimeout(() => {
            const p = this.personalities[this.config.personality];
            this.speak(p.greetings[0]);
        }, 500);

        log('–ì–æ—Ç–æ–≤!');
    },

    updateButtons: function() {
        // –ü–µ—Ä—Å–æ–Ω–∞–∂–∏
        document.querySelectorAll('.btn-row:first-child button').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById('btn-' + this.config.personality).classList.add('active');

        // –ì–æ–ª–æ—Å
        document.querySelectorAll('.btn-row:nth-child(2) button').forEach(btn => {
            btn.classList.remove('active');
        });
        if (document.getElementById('btn-' + this.config.voice)) {
            document.getElementById('btn-' + this.config.voice).classList.add('active');
        }

        // –ê–≤–∞—Ç–∞—Ä
        document.getElementById('avatar').textContent = this.personalities[this.config.personality].emoji;
    },

    setPersonality: function(p) {
        this.config.personality = p;
        localStorage.setItem('glott_p', p);
        this.updateButtons();
        this.speak('–¢–µ–ø–µ—Ä—å —è ' + this.personalities[p].name + '!');
        log('–ü–µ—Ä—Å–æ–Ω–∞–∂: ' + p);
    },

    setVoice: function(v) {
        this.config.voice = v;
        localStorage.setItem('glott_v', v);
        this.updateButtons();
        this.speak('–ì–æ–ª–æ—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ' + this.voices[v].desc);
        log('–ì–æ–ª–æ—Å: ' + v);
    },

    toggleTheme: function() {
        this.config.theme = this.config.theme === 'dark' ? 'light' : 'dark';
        localStorage.setItem('glott_t', this.config.theme);
        location.reload();
    },

    speak: function(text) {
        // –î–æ–±–∞–≤–∏—Ç—å –≤ —á–∞—Ç
        this.addMessage(text, false);

        // –û–∑–≤—É—á–∏—Ç—å
        if (!window.speechSynthesis) {
            log('–û–∑–≤—É—á–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            return;
        }

        window.speechSynthesis.cancel();

        document.getElementById('avatar').classList.add('speaking');
        document.getElementById('status').textContent = '–≥–æ–≤–æ—Ä–∏—Ç';

        const v = this.voices[this.config.voice];
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ru-RU';
        u.rate = v.rate;
        u.pitch = v.pitch;

        // –ù–∞–π—Ç–∏ —Ä—É—Å—Å–∫–∏–π –≥–æ–ª–æ—Å
        const voices = window.speechSynthesis.getVoices();
        const rv = voices.find(voice => voice.lang.includes('ru'));
        if (rv) u.voice = rv;

        u.onend = () => {
            document.getElementById('avatar').classList.remove('speaking');
            document.getElementById('status').textContent = '–≥–æ—Ç–æ–≤';
        };

        window.speechSynthesis.speak(u);
        log('–ì–æ–≤–æ—Ä—é: ' + text.substring(0, 30));
    },

    addMessage: function(text, isUser) {
        const chat = document.getElementById('chat');
        const div = document.createElement('div');
        div.className = 'msg ' + (isUser ? 'user' : 'glott');
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    },

    handleInput: function(text) {
        log('–ü–æ–ª—É—á–µ–Ω–æ: ' + text);
        this.addMessage(text, true);

        // –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
        const lower = text.toLowerCase();
        let response = '';

        if (lower.includes('–ø—Ä–∏–≤–µ—Ç')) {
            response = this.personalities[this.config.personality].greetings[0];
        } else if (lower.includes('–∫–∞–∫ –¥–µ–ª–∞')) {
            response = '–û—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –±–æ–ª—Ç–∞—Ç—å —á–∞—Å–∞–º–∏. –ê —É —Ç–µ–±—è?';
        } else if (lower.includes('—à—É—Ç–∫')) {
            response = '–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ Oct 31 == Dec 25!';
        } else if (lower.includes('–ø–æ–º–æ–≥–∏')) {
            response = '–ö–æ–º–∞–Ω–¥—ã:
‚Ä¢ –ü—Ä–∏–≤–µ—Ç
‚Ä¢ –ö–∞–∫ –¥–µ–ª–∞
‚Ä¢ –®—É—Ç–∫–∞
‚Ä¢ –ò–≥—Ä–∞—Ç—å
‚Ä¢ –ü–æ–∫–∞';
        } else if (lower.includes('–∏–≥—Ä–∞')) {
            this.startGame();
            return;
        } else if (lower.includes('–ø–æ–∫–∞')) {
            response = '–ü–æ–∫–∞! –û–±—Ä–∞—â–∞–π—Å—è!';
        } else {
            response = '–ü–æ–Ω—è–ª —Ç–µ–±—è! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.';
        }

        setTimeout(() => this.speak(response), 300);
    },

    sendText: function() {
        const input = document.getElementById('textInput');
        const text = input.value.trim();
        if (text) {
            this.handleInput(text);
            input.value = '';
        }
    },

    startGame: function() {
        document.getElementById('gameBox').classList.add('active');
        game.init();
        this.speak('–Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100. –£–≥–∞–¥–∞–π!');
    },

    showHelp: function() {
        this.speak('–ù–∞–∂–º–∏—Ç–µ üé§ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ. –ò–ª–∏ –ø–∏—à–∏—Ç–µ –≤ –ø–æ–ª–µ —Å–Ω–∏–∑—É. –ö–Ω–æ–ø–∫–∏ —Å–≤–µ—Ä—Ö—É –º–µ–Ω—è—é—Ç –º–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –≥–æ–ª–æ—Å.');
    },

    exportData: function() {
        const data = JSON.stringify(this.config);
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'glott-settings.json';
        a.click();
        this.speak('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    },

    testVoice: function() {
        this.speak('–¢–µ—Å—Ç –≥–æ–ª–æ—Å–∞! –ï—Å–ª–∏ –≤—ã —Å–ª—ã—à–∏—Ç–µ —ç—Ç–æ, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!');
    }
};

// –ì–æ–ª–æ—Å–æ–≤–æ–π –º–æ–¥—É–ª—å
const voice = {
    rec: null,
    isListening: false,

    init: function() {
        if (!('webkitSpeechRecognition' in window)) {
            log('–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            return false;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        this.rec = new SpeechRecognition();
        this.rec.lang = 'ru-RU';
        this.rec.continuous = false;
        this.rec.interimResults = false;

        this.rec.onstart = () => {
            this.isListening = true;
            document.getElementById('voiceBtn').classList.add('listening');
            document.getElementById('hint').textContent = '–ì–æ–≤–æ—Ä–∏—Ç–µ...';
            document.getElementById('status').textContent = '—Å–ª—É—à–∞—é';
            log('–°–ª—É—à–∞—é...');
        };

        this.rec.onend = () => {
            this.isListening = false;
            document.getElementById('voiceBtn').classList.remove('listening');
            document.getElementById('hint').textContent = '–ù–∞–∂–º–∏—Ç–µ üé§ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ';
            document.getElementById('status').textContent = '–≥–æ—Ç–æ–≤';
        };

        this.rec.onresult = (e) => {
            const text = e.results[0][0].transcript;
            log('–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: ' + text);
            app.handleInput(text);
        };

        this.rec.onerror = (e) => {
            log('–û—à–∏–±–∫–∞: ' + e.error);
            if (e.error === 'not-allowed') {
                alert('–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞!');
            }
        };

        return true;
    },

    toggle: function() {
        if (!this.rec) {
            if (!this.init()) {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –Ω–∞ Android.');
                return;
            }
        }

        if (this.isListening) {
            this.rec.stop();
        } else {
            this.rec.start();
        }
    }
};

// –ò–≥—Ä–∞
const game = {
    target: 0,
    attempts: 0,

    init: function() {
        this.target = Math.floor(Math.random() * 100) + 1;
        this.attempts = 0;
        document.getElementById('attempts').textContent = '0';
        document.getElementById('gameHint').textContent = '';
        document.getElementById('guessInput').value = '';
        log('–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞. –ó–∞–≥–∞–¥–∞–Ω–æ: ' + this.target);
    },

    checkGuess: function() {
        const input = document.getElementById('guessInput');
        const guess = parseInt(input.value);
        const hint = document.getElementById('gameHint');

        if (!guess || guess < 1 || guess > 100) {
            hint.textContent = '–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!';
            hint.style.color = '#f5576c';
            return;
        }

        this.attempts++;
        document.getElementById('attempts').textContent = this.attempts;

        if (guess === this.target) {
            hint.textContent = 'üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í—ã —É–≥–∞–¥–∞–ª–∏ –∑–∞ ' + this.attempts + ' –ø–æ–ø—ã—Ç–æ–∫!';
            hint.style.color = '#4CAF50';
            app.speak('–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—ã —É–≥–∞–¥–∞–ª–∏ —á–∏—Å–ª–æ ' + this.target + '!');
            setTimeout(() => {
                if (confirm('–°—ã–≥—Ä–∞–µ–º –µ—â—ë?')) {
                    this.init();
                } else {
                    document.getElementById('gameBox').classList.remove('active');
                }
            }, 1000);
        } else if (guess < this.target) {
            hint.textContent = 'üîº –ë–æ–ª—å—à–µ!';
            hint.style.color = '#FF9800';
            app.speak('–ë–æ–ª—å—à–µ!');
        } else {
            hint.textContent = 'üîΩ –ú–µ–Ω—å—à–µ!';
            hint.style.color = '#FF9800';
            app.speak('–ú–µ–Ω—å—à–µ!');
        }

        input.value = '';
        input.focus();
    }
};

// –ó–∞–ø—É—Å–∫
window.onload = function() {
    app.init();

    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ–ª–æ—Å–∞
    if (window.speechSynthesis) {
        window.speechSynthesis.onvoiceschanged = function() {
            log('–ì–æ–ª–æ—Å–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ' + window.speechSynthesis.getVoices().length);
        };
    }
};
</script>
</body>
            </html>
