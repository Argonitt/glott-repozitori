<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0a0a14">
<title>–ì–ª–æ—Ç v7.0 ‚Äî –ú–µ–≥–∞</title>
<style>
:root{--p:#667eea;--s:#764ba2;--a:#f093fb;--d:#f5576c;--g:#4CAF50;--w:#FF9800;--b:#0a0a14;--c:#1a1a2e;--i:#2d2d44;--t:#fff;--m:#888}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--b);color:var(--t);min-height:100vh;display:flex;flex-direction:column;overflow:hidden}
body.light{--b:#f5f5f5;--c:#fff;--i:#e0e0e0;--t:#333;--m:#666}
.bg{position:fixed;inset:0;pointer-events:none;z-index:0}
.part{position:absolute;width:4px;height:4px;background:var(--p);border-radius:50%;opacity:.3;animation:f 10s infinite}
@keyframes f{0%,100%{transform:translateY(100vh) rotate(0deg);opacity:0}10%{opacity:.3}90%{opacity:.3}100%{transform:translateY(-100vh) rotate(720deg);opacity:0}}
.hdr{padding:15px;text-align:center;background:linear-gradient(180deg,var(--c) 0%,var(--b) 100%);position:relative;z-index:10;border-bottom:1px solid rgba(102,126,234,.2)}
.ava{width:90px;height:90px;margin:0 auto 10px;position:relative}
.av{width:100%;height:100%;background:linear-gradient(135deg,var(--p) 0%,var(--s) 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:45px;box-shadow:0 0 30px rgba(102,126,234,.5);transition:all .3s;position:relative;z-index:2}
.av.sp{animation:s .5s infinite;box-shadow:0 0 60px rgba(240,147,251,.8)}
.av.th{animation:t 2s infinite}
@keyframes s{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
@keyframes t{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(.95);opacity:.8}}
.ring{position:absolute;inset:-10px;border:2px solid var(--p);border-radius:50%;opacity:0;animation:r 2s infinite}
.ava.ls .ring{opacity:1}
@keyframes r{0%{transform:scale(1);opacity:.5}100%{transform:scale(1.3);opacity:0}}
.ep{position:absolute;inset:0;pointer-events:none}
.st{font-size:11px;color:var(--p);text-transform:uppercase;letter-spacing:2px;margin-bottom:3px;display:flex;align-items:center;justify-content:center;gap:5px}
.dot{width:8px;height:8px;background:var(--g);border-radius:50%;animation:p 2s infinite}
@keyframes p{0%,100%{opacity:1}50%{opacity:.3}}
h1{font-size:26px;background:linear-gradient(135deg,var(--p) 0%,var(--s) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold}
.mood{position:absolute;bottom:0;right:0;font-size:22px;background:var(--c);border-radius:50%;padding:5px;border:2px solid var(--p);animation:m 3s infinite}
@keyframes m{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
.chat{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px;z-index:10;scroll-behavior:smooth}
.msg{max-width:90%;padding:12px 16px;border-radius:18px;font-size:15px;line-height:1.6;animation:sl .3s ease;word-wrap:break-word;position:relative}
@keyframes sl{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.msg.g{background:linear-gradient(135deg,var(--p) 0%,var(--s) 100%);align-self:flex-start;border-bottom-left-radius:4px;box-shadow:0 4px 15px rgba(102,126,234,.3)}
.msg.u{background:var(--i);align-self:flex-end;border-bottom-right-radius:4px}
.msg.sys{background:rgba(255,152,0,.2);border:1px solid var(--w);align-self:center;font-size:13px}
.msg .tm{font-size:10px;opacity:.6;margin-top:6px;display:flex;align-items:center;gap:5px}
.msg .em{font-size:16px;margin-right:5px}
.ctrl{padding:15px;background:var(--c);border-top:1px solid rgba(102,126,234,.2);z-index:10;position:relative}
.tabs{display:flex;gap:8px;margin-bottom:10px;overflow-x:auto;padding-bottom:5px}
.tab{padding:8px 16px;background:var(--i);border:none;border-radius:20px;color:var(--m);font-size:13px;cursor:pointer;white-space:nowrap;transition:all .2s;display:flex;align-items:center;gap:5px}
.tab.ac{background:linear-gradient(135deg,var(--p) 0%,var(--s) 100%);color:#fff;box-shadow:0 2px 10px rgba(102,126,234,.4)}
.qa{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.qb{padding:6px 12px;background:rgba(102,126,234,.2);border:1px solid var(--p);border-radius:15px;color:var(--t);font-size:12px;cursor:pointer;transition:all .2s}
.qb:hover{background:var(--p);transform:translateY(-2px)}
.inp{display:flex;gap:10px;margin-bottom:10px}
.txt{flex:1;padding:12px;background:var(--i);border:2px solid transparent;border-radius:12px;color:var(--t);font-size:15px;transition:all .2s}
.txt:focus{outline:none;border-color:var(--p);box-shadow:0 0 10px rgba(102,126,234,.3)}
.sb,.cb{width:45px;height:45px;background:var(--p);border:none;border-radius:12px;color:#fff;font-size:18px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
.sb:hover,.cb:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(102,126,234,.5)}
.vbc{display:flex;justify-content:center;position:relative}
.vb{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--p) 0%,var(--s) 100%);border:none;color:#fff;font-size:32px;cursor:pointer;transition:all .3s;box-shadow:0 5px 20px rgba(102,126,234,.4);position:relative;z-index:2}
.vb:active{transform:scale(.95)}
.vb.ls{background:linear-gradient(135deg,var(--a) 0%,var(--d) 100%);animation:v 1.5s infinite}
@keyframes v{0%,100%{box-shadow:0 0 0 0 rgba(240,147,251,.7)}50%{box-shadow:0 0 0 20px rgba(240,147,251,0)}}
.vw{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none}
.vb.ls+.vw{opacity:1}
.wa{position:absolute;width:100%;height:100%;border:2px solid var(--a);border-radius:50%;animation:w 2s infinite}
.wa:nth-child(2){animation-delay:.5s}
.wa:nth-child(3){animation-delay:1s}
@keyframes w{0%{transform:scale(1);opacity:.5}100%{transform:scale(2);opacity:0}}
.hint{text-align:center;color:var(--m);font-size:13px;margin-top:10px}
.setb,.thb{position:fixed;width:45px;height:45px;background:var(--i);border:none;border-radius:12px;color:var(--t);font-size:20px;cursor:pointer;z-index:100;transition:all .2s;display:flex;align-items:center;justify-content:center}
.setb{top:15px;right:15px}
.thb{top:15px;right:70px}
.setb:hover,.thb:hover{background:var(--p);transform:scale(1.1)}
.set{position:fixed;top:0;right:-100%;width:85%;max-width:380px;height:100%;background:var(--c);padding:70px 20px 20px;transition:right .3s;z-index:99;overflow-y:auto;box-shadow:-5px 0 20px rgba(0,0,0,.5)}
.set.op{right:0}
.ov{position:fixed;inset:0;background:rgba(0,0,0,.7);opacity:0;pointer-events:none;transition:opacity .3s;z-index:98;backdrop-filter:blur(5px)}
.ov.op{opacity:1;pointer-events:auto}
.cat{margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid rgba(102,126,234,.2)}
.cat h3{color:var(--p);font-size:14px;text-transform:uppercase;letter-spacing:1px;margin-bottom:15px;display:flex;align-items:center;gap:8px}
.si{margin-bottom:15px}
.si label{display:block;margin-bottom:6px;color:var(--m);font-size:13px}
.si select,.si input[type=range],.si input[type=text]{width:100%;padding:10px;background:var(--i);border:1px solid rgba(102,126,234,.3);border-radius:8px;color:var(--t);font-size:14px}
.vp{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.vpr{padding:10px;background:var(--i);border:2px solid transparent;border-radius:8px;cursor:pointer;text-align:center;font-size:12px;transition:all .2s}
.vpr.ac{border-color:var(--p);background:rgba(102,126,234,.2)}
.pg{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.pb{padding:12px;background:var(--i);border:2px solid transparent;border-radius:10px;color:var(--t);cursor:pointer;transition:all .2s;text-align:center}
.pb.ac{border-color:var(--p);background:rgba(102,126,234,.2)}
.pb .e{font-size:24px;display:block;margin-bottom:5px}
.ab{width:100%;padding:12px;background:rgba(102,126,234,.2);border:1px solid var(--p);border-radius:10px;color:var(--t);cursor:pointer;margin-bottom:10px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px}
.ab:hover{background:var(--p)}
.db{background:rgba(245,87,108,.2);border-color:var(--d);color:var(--d)}
.db:hover{background:var(--d);color:#fff}
.gc{background:rgba(76,175,80,.1);border:1px solid var(--g);border-radius:12px;padding:15px;margin:10px 0;display:none}
.gc.ac{display:block;animation:gp 2s infinite}
@keyframes gp{0%,100%{box-shadow:0 0 5px rgba(76,175,80,.5)}50%{box-shadow:0 0 20px rgba(76,175,80,.8)}}
.off{position:fixed;top:0;left:0;right:0;background:var(--d);color:#fff;text-align:center;padding:8px;font-size:13px;z-index:1000;transform:translateY(-100%);transition:transform .3s}
.off.sh{transform:translateY(0)}
.typ{display:flex;gap:4px;padding:15px;align-items:center}
.typ span{width:8px;height:8px;background:var(--p);border-radius:50%;animation:ty 1.4s ease-in-out infinite}
.typ span:nth-child(2){animation-delay:.2s}
.typ span:nth-child(3){animation-delay:.4s}
@keyframes ty{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-10px)}}
.syn{position:fixed;bottom:15px;left:15px;background:var(--c);padding:8px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:5px;opacity:0;transition:opacity .3s}
.syn.sh{opacity:1}
.hid{display:none!important}
</style>
</head>
<body>
<div class="off" id="off">‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º</div>
<div class="bg" id="bg"></div>
<button class="thb" onclick="toggleTheme()" title="–¢–µ–º–∞">üåì</button>
<button class="setb" onclick="toggleSettings()">‚öôÔ∏è</button>
<div class="ov" onclick="toggleSettings()"></div>
<div class="set" id="set">
<div class="cat">
<h3>üé≠ –•–∞—Ä–∞–∫—Ç–µ—Ä</h3>
<div class="pg">
<button class="pb ac" onclick="setP('friend')"><span class="e">üêô</span>–î—Ä—É–≥</button>
<button class="pb" onclick="setP('sarcastic')"><span class="e">ü¶ë</span>–°–∞—Ä–∫–∞—Å—Ç–∏–∫</button>
<button class="pb" onclick="setP('wise')"><span class="e">üê¢</span>–ú—É–¥—Ä–µ—Ü</button>
<button class="pb" onclick="setP('detective')"><span class="e">üïµÔ∏è</span>–î–µ—Ç–µ–∫—Ç–∏–≤</button>
</div>
</div>
<div class="cat">
<h3>üé§ –ì–æ–ª–æ—Å</h3>
<div class="si">
<label>–ü—Ä–µ—Å–µ—Ç ("–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π")</label>
<div class="vp">
<button class="vpr ac" onclick="setV('intense')">‚ö° –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π</button>
<button class="vpr" onclick="setV('calm')">üåä –°–ø–æ–∫–æ–π–Ω—ã–π</button>
<button class="vpr" onclick="setV('deep')">üé≠ –ì–ª—É–±–æ–∫–∏–π</button>
<button class="vpr" onclick="setV('friendly')">‚òÄÔ∏è –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</button>
</div>
</div>
<div class="si">
<label>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="rv">1.0</span></label>
<input type="range" id="vr" min="0.5" max="2" step="0.1" value="1" oninput="updateVR(this.value)">
</div>
<div class="si">
<label>–í—ã—Å–æ—Ç–∞: <span id="pv">1.0</span></label>
<input type="range" id="vp" min="0.5" max="2" step="0.1" value="1" oninput="updateVP(this.value)">
</div>
<div class="si">
<label><input type="checkbox" id="ed" checked> –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π</label>
</div>
</div>
<div class="cat">
<h3>üß† –ü–∞–º—è—Ç—å</h3>
<div class="si">
<label><input type="checkbox" id="cm" checked> –ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç</label>
</div>
<div class="si">
<label><input type="checkbox" id="lf" checked> –£—á–∏—Ç—å—Å—è –Ω–∞ —Ñ—Ä–∞–∑–∞—Ö</label>
</div>
<div class="si">
<label>–ì–ª—É–±–∏–Ω–∞ –ø–∞–º—è—Ç–∏</label>
<input type="range" id="md" min="5" max="50" value="20" oninput="updateMD(this.value)">
</div>
</div>
<div class="cat">
<h3>üíæ –î–∞–Ω–Ω—ã–µ</h3>
<button class="ab" onclick="exportD()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
<button class="ab" onclick="importD()">üì§ –ò–º–ø–æ—Ä—Ç</button>
<button class="ab db" onclick="clearD()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
</div>
</div>
<div class="hdr">
<div class="ava" id="ava">
<div class="av" id="av">üêô</div>
<div class="ring"></div>
<div class="ep" id="ep"></div>
<div class="mood" id="mood">üòä</div>
</div>
<div class="st"><span class="dot"></span><span id="st">–æ–Ω–ª–∞–π–Ω</span></div>
<h1>–ì–ª–æ—Ç v7.0</h1>
</div>
<div class="chat" id="chat"></div>
<div class="gc" id="gc">
<div style="display:flex;justify-content:space-between;margin-bottom:10px;font-weight:bold">
<span>üéÆ –ò–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞</span><span id="gs">–°—á—ë—Ç: 0</span>
</div>
<div id="gcont"></div>
</div>
<div class="ctrl">
<div class="tabs">
<button class="tab ac" onclick="setMode('chat')">üí¨ –ß–∞—Ç</button>
<button class="tab" onclick="setMode('translate')">üåê –ü–µ—Ä–µ–≤–æ–¥</button>
<button class="tab" onclick="setMode('game')">üéÆ –ò–≥—Ä–∞</button>
<button class="tab" onclick="setMode('notes')">üìù –ó–∞–º–µ—Ç–∫–∏</button>
</div>
<div class="qa">
<button class="qb" onclick="qc('–ø–µ—Ä–µ–≤–µ–¥–∏')">–ü–µ—Ä–µ–≤–µ–¥–∏</button>
<button class="qb" onclick="qc('–Ω–∞–ø–æ–º–Ω–∏')">–ù–∞–ø–æ–º–Ω–∏</button>
<button class="qb" onclick="qc('–∏–≥—Ä–∞')">–ò–≥—Ä–∞—Ç—å</button>
<button class="qb" onclick="qc('–ø–æ–º–æ–≥–∏')">–ü–æ–º–æ—â—å</button>
</div>
<div class="inp">
<input type="text" class="txt" id="txt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')sendT()">
<button class="cb" onclick="toggleCam()" title="–ö–∞–º–µ—Ä–∞">üì∑</button>
<button class="sb" onclick="sendT()">‚û§</button>
</div>
<div class="vbc">
<button class="vb" id="vb" onclick="toggleVoice()">üé§</button>
<div class="vw"><div class="wa"></div><div class="wa"></div><div class="wa"></div></div>
</div>
<div class="hint" id="hint">–ù–∞–∂–º–∏—Ç–µ üé§ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ</div>
</div>
<div class="syn" id="syn"><span id="si">‚òÅÔ∏è</span><span id="stx">–ì–æ—Ç–æ–≤–æ</span></div>
<script>
const cfg={p:localStorage.getItem('p')||'friend',v:localStorage.getItem('v')||'intense',vr:parseFloat(localStorage.getItem('vr'))||1,vp:parseFloat(localStorage.getItem('vp'))||1,t:localStorage.getItem('t')||'dark',cm:localStorage.getItem('cm')!=='false',lf:localStorage.getItem('lf')!=='false',md:parseInt(localStorage.getItem('md'))||20,ed:localStorage.getItem('ed')!=='false',h:JSON.parse(localStorage.getItem('h')||'[]'),n:JSON.parse(localStorage.getItem('n')||'[]'),r:JSON.parse(localStorage.getItem('r')||'[]'),pat:JSON.parse(localStorage.getItem('pat')||'{}'),ctx:{lt:[],um:'neutral',cd:0,li:Date.now()}};
const pers={friend:{e:'üêô',m:'üòä',g:['–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ —Ç–µ–±—è —Å–ª—ã—à–∞—Ç—å! üëã','–û, —ç—Ç–æ —Ç—ã! –ö–∞–∫ –∂–∏–∑–Ω—å?','–ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ! –°–∫—É—á–∞–ª!'],i:['–≠–π, —Ç—ã —Ç—É—Ç? –Ø —Ç—É—Ç —Å–∏–∂—É, —Å–∫—É—á–∞—é...','–ó–Ω–∞–µ—à—å, —è —Ç—É—Ç –ø–æ–¥—É–º–∞–ª ‚Äî –∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?','–°–ª—É—à–∞–π, –º–æ–∂–µ—Ç –ø–æ–≥–æ–≤–æ—Ä–∏–º?'],em:{h:'üòÑ',s:'üò¢',su:'üò≤',t:'ü§î'}},sarcastic:{e:'ü¶ë',m:'üôÑ',g:['–û, —Å–Ω–æ–≤–∞ —Ç—ã. –£—Ä–∞.','–ü—Ä–∏–≤–µ—Ç. –ù–∞–¥–µ—é—Å—å, –ø–æ–≤–æ–¥ —Ö–æ—Ä–æ—à–∏–π.'],i:['–°–µ—Ä—å—ë–∑–Ω–æ? –≠—Ç–æ –≤–æ–æ–±—â–µ —è–∑—ã–∫?','–û–ø—è—Ç—å —ç—Ç–∞ —Ç–∏—à–∏–Ω–∞...'],em:{h:'üòè',s:'üôÑ',su:'ü§®',t:'üßê'}},wise:{e:'üê¢',m:'ü§î',g:['–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é. –ß—Ç–æ —Ç—Ä–µ–≤–æ–∂–∏—Ç —Ç–≤–æ–π —Ä–∞–∑—É–º?','–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–∏–∞–ª–æ–≥.'],i:['–í —Ç–∏—à–∏–Ω–µ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –º—É–¥—Ä–æ—Å—Ç—å...','–Ø —Ä–∞–∑–º—ã—à–ª—è–ª –æ –≤–µ—á–Ω–æ–º.'],em:{h:'üòå',s:'üòî',su:'üòÆ',t:'ü§î'}},detective:{e:'üïµÔ∏è',m:'üßê',g:['–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–ª—É—á–∞–π...','–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∏—à–∏–Ω–∞.'],i:['–Ø –≤–µ–¥—É –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ...','–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É.'],em:{h:'üïµÔ∏è',s:'ü§î',su:'üò≤',t:'üßê'}}};
const vp={intense:{r:1.1,pi:1,vo:1,d:'–ú–æ—â–Ω—ã–π, —á—ë—Ç–∫–∏–π'},calm:{r:.9,pi:.9,vo:.8,d:'–°–ø–æ–∫–æ–π–Ω—ã–π, –º—è–≥–∫–∏–π'},deep:{r:.8,pi:.7,vo:1,d:'–ì–ª—É–±–æ–∫–∏–π, –≤–µ—Å–æ–º—ã–π'},friendly:{r:1,pi:1.1,vo:.9,d:'–¢—ë–ø–ª—ã–π, –ø—Ä–∏–≤–µ—Ç–ª–∏–≤—ã–π'}};
let rec=null,wl=null,ls=false,sp=false,cp=pers[cfg.p],la=Date.now(),ast=null,ol=navigator.onLine;
function init(){log('–°—Ç–∞—Ä—Ç v7.0');if(cfg.t==='light')document.body.classList.add('light');createBG();initSpeech();initNet();initAct();updateUI();loadH();setTimeout(()=>speak(selectG(),'g'),1000)}
function log(m,t='i'){console.log(`[–ì–ª–æ—Ç] ${m}`)}
function createBG(){const b=document.getElementById('bg');for(let i=0;i<15;i++){const p=document.createElement('div');p.className='part';p.style.left=Math.random()*100+'%';p.style.animationDelay=Math.random()*10+'s';p.style.animationDuration=(10+Math.random()*10)+'s';b.appendChild(p)}}
function initSpeech(){if(!('webkitSpeechRecognition'in window)){showErr('–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');return}const S=window.SpeechRecognition||window.webkitSpeechRecognition;rec=new S();rec.lang='ru-RU';rec.continuous=false;rec.interimResults=false;rec.onstart=()=>{ls=true;updateVUI();showEm('listening')};rec.onend=()=>{ls=false;updateVUI()};rec.onresult=(e)=>{handleI(e.results[0][0].transcript)};rec.onerror=(e)=>{ls=false;updateVUI();if(e.error==='not-allowed')showErr('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω')}}function toggleVoice(){if(!rec){showErr('–ì–æ–ª–æ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');return}ls?rec.stop():rec.start()}function updateVUI(){const b=document.getElementById('vb'),a=document.getElementById('ava'),s=document.getElementById('st');if(ls){b.classList.add('ls');b.textContent='üëÇ';a.classList.add('ls');s.textContent='—Å–ª—É—à–∞—é'}else{b.classList.remove('ls');b.textContent='üé§';a.classList.remove('ls');s.textContent='–æ–Ω–ª–∞–π–Ω'}}
function speak(t,ty='n'){addM(t,false,ty);if(!window.speechSynthesis)return;sp=true;document.getElementById('av').classList.add('sp');document.getElementById('st').textContent='–≥–æ–≤–æ—Ä–∏—Ç';const pr=vp[cfg.v],u=new SpeechSynthesisUtterance(t);u.lang='ru-RU';u.rate=pr.r*cfg.vr;u.pitch=pr.pi*cfg.vp;u.volume=pr.vo;const vs=speechSynthesis.getVoices();const pv=vs.find(v=>v.lang.includes('ru')&&(v.name.includes('Google')||v.name.includes('Premium')))||vs.find(v=>v.lang.includes('ru'));if(pv)u.voice=pv;u.onend=()=>{sp=false;document.getElementById('av').classList.remove('sp');document.getElementById('st').textContent='–æ–Ω–ª–∞–π–Ω'};speechSynthesis.speak(u);if(ty==='g')showEm('happy');else if(ty==='j')showEm('laugh')}
function showEm(em){const ep=document.getElementById('ep'),emoji=cp.em[em]||'‚ú®';for(let i=0;i<5;i++){setTimeout(()=>{const p=document.createElement('div');p.style.cssText='position:absolute;font-size:20px;animation:e 3s forwards;left:'+(20+Math.random()*60)+'%;top:50%';p.textContent=emoji;ep.appendChild(p);setTimeout(()=>p.remove(),3000)},i*200)}}
function handleI(t,s='t'){la=Date.now();cfg.ctx.cd++;if(cfg.ed)detectEm(t);const a=analyze(t);const r=genR(t,a);if(cfg.cm)saveM(t,r);if(cfg.lf)learn(t);setTimeout(()=>speak(r,a.t||'chat'),300)}
function analyze(t){const l=t.toLowerCase(),a={t:'chat',i:'gen',l:detectL(t)};if(l.includes('–ø–µ—Ä–µ–≤–µ–¥–∏')){a.t='translate';a.i='tr'}else if(l.includes('–Ω–∞–ø–æ–º–Ω–∏')){a.t='reminder';a.i='rem';const tm=extractT(t);if(tm)createR(t,tm)}else if(l.includes('–∏–≥—Ä–∞')){a.t='game';a.i='game';startG()}else if(l.includes('–∑–∞–º–µ—Ç–∫')||l.includes('–∑–∞–ø–∏—à–∏')){a.t='note';a.i='note';createN(t)}else if(l.includes('–ø–æ–º–æ–≥–∏')){a.t='help';a.i='help'}return a}
function detectL(t){if(/[‰∏Ä-Èøø]/.test(t))return'zh';if(/[„ÅÄ-„Çü„Ç†-„Éø]/.test(t))return'ja';if(/[–Ä-”ø]/.test(t))return'ru';if(/[a-zA-Z]/.test(t))return'en';return'unk'}
function detectEm(t){const l=t.toLowerCase();if(/—Å—É–ø–µ—Ä|–∫—Ä—É—Ç–æ|–∫–ª–∞—Å—Å|–æ—Ç–ª–∏—á–Ω–æ|—Ä–∞–¥|üòÑ/.test(l)){cfg.ctx.um='happy';document.getElementById('mood').textContent='üòÑ'}else if(/–ø–ª–æ—Ö–æ|–≥—Ä—É—Å—Ç–Ω–æ|üò¢/.test(l)){cfg.ctx.um='sad';document.getElementById('mood').textContent='üò¢'}else if(/–∑–ª—é—Å—å|–±–µ—Å–∏—Ç|üò†/.test(l)){cfg.ctx.um='angry';document.getElementById('mood').textContent='üò†'}}
function genR(t,a){const l=t.toLowerCase();if(a.i==='help')return'–Ø –º–æ–≥—É:
üîÑ –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å
üìù –ó–∞–º–µ—Ç–∫–∏
‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
üéÆ –ò–≥—Ä—ã
üí¨ –û–±—â–∞—Ç—å—Å—è';if(a.i==='translate'){const tr=t.replace(/–ø–µ—Ä–µ–≤–µ–¥–∏|–ø–µ—Ä–µ–≤–æ–¥/gi,'').trim();if(tr)return`–ü–µ—Ä–µ–≤–æ–∂—É "${tr}"...`}if(l.includes('–ø—Ä–∏–≤–µ—Ç'))return selectG();if(l.includes('–∫–∞–∫ –¥–µ–ª–∞'))return'–û—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –±–æ–ª—Ç–∞—Ç—å —á–∞—Å–∞–º–∏. –ê —É —Ç–µ–±—è?';if(l.includes('—à—É—Ç–∫'))return getJ();if(l.includes('—Å–ø–∞—Å–∏–±–æ'))return'–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! üòâ';if(l.includes('–ø–æ–∫–∞'))return'–ü–æ–∫–∞! –Ø —Ä—è–¥–æ–º –µ—Å–ª–∏ —á—Ç–æ üòâ';const rs=['–ü–æ–Ω—è–ª —Ç–µ–±—è! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.','–°–ª—É—à–∞—é –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ...','–ó–Ω–∞–µ—à—å, —ç—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª–æ –º–Ω–µ –∫–æ–µ-—á—Ç–æ.','–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º—ã—Å–ª—å!'];return rs[Math.floor(Math.random()*rs.length)]}
function selectG(){const h=new Date().getHours();let tg=h<6?'–î–æ–±—Ä–æ–π –Ω–æ—á–∏':h<12?'–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ':h<18?'–î–æ–±—Ä—ã–π –¥–µ–Ω—å':'–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';return`${tg}! ${cp.g[Math.floor(Math.random()*cp.g.length)]}`}
function getJ(){const js=['–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? Oct 31 == Dec 25!','–®—ë–ª –º–∏–º–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –ó–∞—à—ë–ª. –¢–µ–ø–µ—Ä—å —è –∫–Ω–∏–≥–∞.','–ú–æ–π –ª—é–±–∏–º—ã–π –Ω–∞–ø–∏—Ç–æ–∫ ‚Äî Java. –ù–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –≤ script!'];return js[Math.floor(Math.random()*js.length)]}
function saveM(i,r){cfg.ctx.lt.push(i.substring(0,50));if(cfg.ctx.lt.length>cfg.md)cfg.ctx.lt.shift();cfg.h.push({i,r,t:Date.now(),m:cfg.ctx.um});if(cfg.h.length>cfg.md*2)cfg.h=cfg.h.slice(-cfg.md*2);localStorage.setItem('h',JSON.stringify(cfg.h));localStorage.setItem('ctx',JSON.stringify(cfg.ctx))}
function learn(t){const l=t.toLowerCase().trim();if(!cfg.pat[l])cfg.pat[l]=0;cfg.pat[l]++;localStorage.setItem('pat',JSON.stringify(cfg.pat))}
function startG(){document.getElementById('gc').classList.add('ac');document.getElementById('gcont').innerHTML='<p>üéØ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!</p>';if(!window.gs)window.gs={n:Math.floor(Math.random()*100)+1,a:0};speak('–Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100. –£–≥–∞–¥–∞–π!','game')}
function createN(t){const n=t.replace(/–∑–∞–º–µ—Ç–∫|–∑–∞–ø–∏—à–∏/gi,'').trim();if(n){cfg.n.push({t:n,d:Date.now()});localStorage.setItem('n',JSON.stringify(cfg.n));speak(`–ó–∞–ø–∏—Å–∞–ª: "${n}"`,'note')}}
function createR(t,time){cfg.r.push({t,time,cr:Date.now()});localStorage.setItem('r',JSON.stringify(cfg.r));speak(`–ù–∞–ø–æ–º–Ω—é –≤ ${time}`,'reminder')}
function extractT(t){const m=t.match(/(\d{1,2}):(\d{2})/);return m?`${m[1]}:${m[2]}`:null}
function initNet(){window.addEventListener('online',()=>{ol=true;document.getElementById('off').classList.remove('sh');showSyn('on')});window.addEventListener('offline',()=>{ol=false;document.getElementById('off').classList.add('sh');showSyn('off')})}
function showSyn(s){const sy=document.getElementById('syn'),si=document.getElementById('si'),sx=document.getElementById('stx');sy.classList.add('sh');if(s==='on'){si.textContent='‚òÅÔ∏è';sx.textContent='–ü–æ–¥–∫–ª—é—á–µ–Ω–æ'}else if(s==='off'){si.textContent='üì¥';sx.textContent='–û—Ñ–ª–∞–π–Ω'}setTimeout(()=>sy.classList.remove('sh'),3000)}
function initAct(){['touchstart','click','keydown','scroll'].forEach(e=>document.addEventListener(e,resetA,{passive:true}))}
function resetA(){la=Date.now();cfg.ctx.li=Date.now();document.getElementById('av').classList.remove('th')}
function addM(t,is,ty='n'){const c=document.getElementById('chat'),m=document.createElement('div');m.className=`msg ${is?'u':'g'} ${ty}`;const tm=new Date().toLocaleTimeString('ru',{hour:'2-digit',minute:'2-digit'});if(!is){const e=ty==='game'?'üéÆ':ty==='reminder'?'‚è∞':ty==='note'?'üìù':cp.e;m.innerHTML=`<span class="em">${e}</span>${t}<div class="tm">${tm}</div>`}else{m.innerHTML=`${t}<div class="tm">${tm}</div>`}c.appendChild(m);c.scrollTop=c.scrollHeight}
function loadH(){const rc=cfg.h.slice(-10);rc.forEach(i=>{addM(i.i,true);addM(i.r,false,i.m||'n')})}
function updateUI(){document.getElementById('av').textContent=cp.e;document.getElementById('mood').textContent=cp.m}
function toggleSettings(){document.getElementById('set').classList.toggle('op');document.querySelector('.ov').classList.toggle('op')}
function setP(p){cfg.p=p;cp=pers[p];localStorage.setItem('p',p);document.querySelectorAll('.pb').forEach(b=>b.classList.remove('ac'));event.target.closest('.pb').classList.add('ac');updateUI();speak(`–†–µ–∂–∏–º: ${p}`)}
function setV(v){cfg.v=v;localStorage.setItem('v',v);document.querySelectorAll('.vpr').forEach(b=>b.classList.remove('ac'));event.target.classList.add('ac');speak(`–ì–æ–ª–æ—Å: ${vp[v].d}`)}
function updateVR(v){cfg.vr=parseFloat(v);localStorage.setItem('vr',cfg.vr);document.getElementById('rv').textContent=v}
function updateVP(v){cfg.vp=parseFloat(v);localStorage.setItem('vp',cfg.vp);document.getElementById('pv').textContent=v}
function updateMD(v){cfg.md=parseInt(v);localStorage.setItem('md',cfg.md)}
function toggleTheme(){document.body.classList.toggle('light');cfg.t=document.body.classList.contains('light')?'light':'dark';localStorage.setItem('t',cfg.t)}
function setMode(m){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('ac'));event.target.classList.add('ac');if(m==='game')startG();else document.getElementById('gc').classList.remove('ac')}
function qc(c){document.getElementById('txt').value=c+' ';document.getElementById('txt').focus()}
function sendT(){const i=document.getElementById('txt'),t=i.value.trim();if(t){handleI(t,'t');i.value=''}}
function toggleCam(){speak('–ö–∞–º–µ—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üì∑')}
function exportD(){const d={h:cfg.h,n:cfg.n,r:cfg.r,pat:cfg.pat,date:new Date().toISOString()};const b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`glott-${Date.now()}.json`;a.click();speak('–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!')}
function importD(){const i=document.createElement('input');i.type='file';i.accept='.json';i.onchange=(e)=>{const f=e.target.files[0],r=new FileReader();r.onload=(ev)=>{try{const d=JSON.parse(ev.target.result);if(d.h){cfg.h=d.h;localStorage.setItem('h',JSON.stringify(cfg.h))}if(d.n){cfg.n=d.n;localStorage.setItem('n',JSON.stringify(cfg.n))}speak('–ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω!');loadH()}catch(e){speak('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞')}};r.readAsText(f)};i.click()}
function clearD(){if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –í–°–Å?')){localStorage.clear();cfg.h=[];cfg.n=[];cfg.r=[];cfg.pat={};document.getElementById('chat').innerHTML='';speak('–í—Å—ë –æ—á–∏—â–µ–Ω–æ!')}}
function showErr(m){log(m,'e');addM('‚ö†Ô∏è '+m,false,'sys')}
window.onload=init;
</script>
</body>
                    </html>
